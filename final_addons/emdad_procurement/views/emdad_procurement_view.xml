<?xml version="1.0" encoding="utf-8"?>
<emdad>
   <record id="emdad_procurement_view_form" model="ir.ui.view">
    <field name="name">emdad_procurement.view.form</field>
    <field name="model">emdad.procurement</field>
    <field name="arch" type="xml">
        <form string="">
        <header>
            <button string="Approve" type="object" name="approve_quote" invisible = "status == 'active'"/>
            <button string="Publish" type="object" name="publish_quote" invisible = "published == True"/>
            <button string="Close Order" type="object" name="close_quote" invisible = "status != 'active'"/>
            <button string="Recieve" type="object" name="recieved_process" invisible = "in_recieve == True"/>
            <button string="Create Quantities" type="object" name="create_inventory_input" invisible = " status != 'recieve'"/>
            <button string="Create Bill" type="object" name="create_bill_je" invisible="bill_status == 'created'"/>
            <button string="Create Payment" type="object" name="create_payment" invisible="payment_status == 'paid'"/>
            <field name="status" widget="statusbar" statusbar_visible="pending,active,closed,expired,recieve" />
        </header>
            <sheet>
            <div class="oe_title">
            <field name="stages" widget="badge"/>
            Procurement ID 
            <h1>
                <field name="name"/>
            </h1>
            </div>
            <group string="Request Information">
                <group>
                <field name="emdad_category"/>
                <field name="effective_date"/>
                <field name="exp_quote"/>
                <field name="operation_type"/>
                <field name="process_type"/>
                <field name="payment_type"/>
                <field name="distribution_type"/>
                <field name="single_location" invisible = "distribution_type != 'single'" domain="[('used_reciepts', '=', True)]"/>
                <field name="status"/>
                <field name="published" invisible="1"/>
                <field name="is_multiple" invisible="1"/>
                <field name="all_info" invisible="1"/>
                <field name="in_recieve" invisible="1"/>
                <field name="related_bill" readonly="1" invisible="bill_status == 'not'"/>
                <field name="bill_status" widget="badge" invisible="status == 'pending'"/>
                </group>
                 <group>
                <field name="vendor" domain="[('contact_type', '=', 'vendor')]" invisible = "process_type != 'direct'"/>
                <field name="vendors" domain="[('contact_type', '=', 'vendor')]" invisible = "process_type != 'multiple'" widget="many2many_tags"/>
                <field name="vendor_phone" widget="phone" invisible = "process_type != 'direct'"/>
                <field name="credit_facility"/>
                <field name="credit_balance"/>
                <field name="credit_value"/>
                <field name="amount_pay" invisible="payment_status == 'paid'"/>
                <field name="payment_date" invisible="payment_status == 'paid'"/>
                <field name="payment_journal" invisible="payment_status == 'paid'"/>
                </group>
                <group string="Request Finances" invisible="status == 'pending'">
                <group>
                    <field name="total_before_discount" string="Before Discount"/>
                    <field name="total_discount"/>
                    <field name="total_amount"/>
                    <field name="payment_status" invisible="1"/>
                    <field name="procurement_backorder" invisible="1"/>
                    <button string="Create Backorder" type="object" name="create_back_order" invisible="procurement_backorder == False" class="oe_highlight"/>
                </group>
                    
                </group>
                <notebook>
                    <page name="product_list" string="Products">
                         <field name="procurement_lines" widget="one2many_list" invisible = "all_info != True" context="{'default_vendor' : vendor, 'default_location': single_location, 'default_is_multiple': is_multiple, 'default_product_category': emdad_category}">
                            <kanban>
                              <t t-name="kanban-box">
                               <div t-attf-class="oe_kanban_global_click">
                                <t t-name="kanban-box">
                  <div t-attf-class="oe_kanban_global_click">
                      <div class="o_kanban_image">
                          <img t-att-src="kanban_image('emdad.line.procurement', 'product_image', record.id.raw_value)" alt="Book"
                              class="o_image_128_contain"/>
                      </div>
                      <div class="oe_kanban_details">
                          <strong class="o_kanban_record_title">
                          <field name="product_id"/>
                          <br></br>
                          <field name="product_category"/>
                          </strong>
                      <div>
                             Requested Quantity: <field name="request_qty"/> <field name="metric"/>
                             <br></br>
                              Barcode: <field name="barcode"/>
                              <field name="proc_status" invisible="1"/>
                      </div>
                      <div invisible="proc_status == 'recieve'">
                            Recieved Quantity : <field name="recieved_qty"/> <field name="metric"/>
                            <br></br>
                            Difference : <field name="difference"/> <field name="metric"/>
                            <br></br>
                            <field name="recieve_status" widget="badge" invisible="proc_status == 'pending'"/>

                      </div>
                      <div invisible="proc_status == 'pending'">                                                
                            Total : <field name="after_tax"/> SAR                             
                      </div>
                      
                      <div>
                      <hr></hr>
                         <field name="description"/>
                      </div>
                      </div>
                  </div>
              </t>
                                </div>
                                </t>
                            </kanban>
                        </field>                
                    </page>
                    <page name="pricing" string="Pricing List" invisible="status == 'pending'">
                        <field name="procurement_lines" context="{'default_product_category' : emdad_category}">
                            <tree editable="bottom">
                                 <field name="barcode"/>
                                <field name="product_id"/>
                                <field name="expense_account"/>
                                <!-- <field name="attach"/> -->
                                <!-- <field name="packaging"/> -->
                                <!-- <field name="request_qty"/> -->
                                <!-- <field name="batch" invisible = "in_recieve != True" widget="many2one_new" options="{'no_open': True}"/> -->
                                <!-- <field name="recieved_qty" invisible = "in_recieve != True"/> -->
                                <!-- <field name="difference" invisible = "in_recieve != True"/> -->
                                 <!-- <field name="recieve_status" widget="badge" invisible = "in_recieve != True"/> -->
                                <!-- <field name="metric" domain="[('metric', '=', related_metric)]"/> -->
                                <field name="product_cost"/>
                                <field name="tax_amount"/>
                                <field name="discount"/>
                                <!-- <field name="in_recieve" optional="hide"/> -->
                                <field name="total"/>
                                <field name="final_total"/>
                                <field name="taxes"/>
                                <field name="after_tax"/>
                                <!-- <field name="location" invisible = "is_multiple != True"/> -->
                                <field name="vendor" optional="hide"/>
                                <field name="is_multiple" optional="hide"/>
                                <field name="related_metric" optional="hide"/>
                            </tree>
                        </field>
                    </page>
                    <page name="recieve" string="Recieving Information" invisible="status != 'recieve'">
                        <field name="procurement_lines" widget="One2many_list">
                            <tree editable="bottom">
                                <field name="barcode"/>
                                <field name="product_id"/>
                                <field name="attach" widget="download_link" options="{'filename': 'attach_fname'}"/>
                                <field name="request_qty"/>
                                <field name="recieved_qty"/>
                                <field name="difference"/>
                                <field name="metric"/>
                                <field name="recieve_status"/>
                                <field name="is_multiple" invisible="1" optional="hide"/>
                                <field name="location" invisible = "is_multiple != True"/>
                            </tree>
                        </field>
                        
                    </page>
                </notebook>
           </group>
            </sheet>
        </form>
    </field>
   </record>
   
   <record id="emdad_line_procurement_view_form" model="ir.ui.view">
    <field name="name">emdad_line_procurement.view.form</field>
    <field name="model">emdad.line.procurement</field>
    <field name="arch" type="xml">
        <form string="Add a Procurement Line">
            <sheet>
                <group>
                    <group string="Product Information">
                        <field name="product_id" domain="[('category', '=', product_category)]"/>
                        <field name="barcode"/>
                        <field name="product_category"/>
                        <field name="product_image" widget="image" class="oe_avatar" options='{"size": [100, 100]}'/>
                    </group>
                    <group string="Request Details">
                        <field name="packaging"/>
                        <field name="request_qty"/>
                        <field name="metric" domain="[('metric', '=', related_metric)]"/>
                        <field name="related_metric" optional="hide"/>
                    </group>
                </group>
                <group>
                    <group string="Logistics">
                        <field name="location"/>
                        <field name="recieved_qty" invisible="proc_status != 'recieve'"/>
                        <field name="recieve_status" widget="badge" invisible="proc_status != 'recieve'"/>
                        <field name="proc_status" invisible="1"/>
                    </group>
                    <group string="Branding">
                        <field name="attach"/>
                        <field name="description"/>
                    </group>
                </group>
                <group invisible="proc_status == 'pending'">
                    <group string="Pricing">
                        <field name="product_cost"/>
                        <field name="discount"/>
                        <field name="tax_amount"/>
                    </group>
                    <group string="Finances">
                        <field name="total"/>
                        <field name="final_total"/>
                        <field name="taxes" readonly="1"/>
                        <field name="after_tax" readonly="1"/>
                    </group>
                </group>
            </sheet>
        </form>
    </field>
   </record>
    <record id="emdad_procurement_quick_view_form" model="ir.ui.view">
    <field name="name">emdad_procurement_quick.view.form</field>
    <field name="model">emdad.procurement</field>
    <field name="arch" type="xml">
        <form string="Quick Edit Form" >
            <group>
                <field name="process_type" string="Source"/>
                <field name="vendor" domain="[('contact_type', '=', 'vendor')]" invisible = "process_type != 'direct'"/>
                <field name="operation_type" string="Operation"/>
                <field name="exp_quote" string="Expiary"/>
                <field name="distribution_type" string="Distribution"/>
                <field name="single_location" invisible = "distribution_type != 'single'" domain="[('used_reciepts', '=', True)]"/>
            </group>
        </form>
    </field>
</record>

    <record id="emdad_procurement_view_kanban" model="ir.ui.view">
        <field name="name">emdad_procurement_kanban.view.kanban</field>
        <field name="model">emdad.procurement</field>
        <field name="arch" type="xml">
            <kanban default_group_by="process_type"
                    quick_create_view="emdad_procurement.emdad_procurement_quick_view_form"
                    class="o_kanban_small_column"
                    on_create="quick_create"
                    sample="1">
                <templates>
                  <t t-name="kanban-box">
                               <div t-attf-class="oe_kanban_global_click">
                                <t t-name="kanban-box">
                                    <div t-attf-class="oe_kanban_global_click">
                                        <div class="o_kanban_image">
                                            <img src="https://i.imgur.com/UnPh60y.png" height="150px" invisible="process_type != 'direct'"/>
                                            <img src="https://i.imgur.com/T65O5f1.png" height="150px" invisible="process_type != 'market'"/>
                                            <img src="https://i.imgur.com/27DAaok.png" height="150px" invisible="process_type != 'multiple'"/>
                                        </div>
                                        <div class="oe_kanban_details">
                                            <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                            <br></br>
                                            </strong>
                                            <field name="process_type"/>
                                            <br></br>
                                            <i class="fa fa fa-calendar"/>
                                            Date : <field name="effective_date"/>
                                            <br></br> 
                                            <i class="fa  fa-random"/> <field name="emdad_category"/>              
                                            <div invisible="process_type != 'market'">
                                            <i class="fa fa-globe"/>
                                            Emdad Market
                                            </div>
                                             <div invisible="process_type != 'direct'">
                                            <field name="vendor" widget="badge"/>
                                            </div>
                                            <div invisible="process_type != 'multiple'">
                                            <i class="fa fa fa-bandcamp"/> Assigned 
                                            <field name="number_vendors"/> Vendors
                                            </div>
                                            <br></br>
                                            
                                        </div>
                                    </div>
                                </t>
                                </div>
                                </t>
                </templates>
            </kanban>
        </field>
    </record>
    <record id="emdad_tender_view_form" model="ir.ui.view">
        <field name="name">emdad_tender.view.form</field>
        <field name="model">emdad.tender</field>
        <field name="arch" type="xml">
            <form string="">
            <header>
                    <button string="Approve" type="object" name="approve_tender" invisible="status == 'rfp'"/>
                    <field name="status" widget="statusbar" statusbar_visible="draft,rfp,po,bill,recieve"/>
                </header>
                <sheet>
                
                <div class="oe_title">
                    <h1>
                        <field name="name"/>
                    </h1>
                </div>
                    <group string="Tender Information">
                        <field name="exp_date"/>
                    </group>
                    <notebook>
                        <page name="products" string="Requested Products">
                        <field name="products" widget="One2many_list">
                            <tree editable="bottom">
                                <field name="product_category"/>
                                <field name="product_id" domain="[('category', '=', product_category)]"/>
                                <field name="barcode"/>
                                <field name="description"/>
                                <field name="attach"/>
                                <field name="request_qty"/>
                                <field name="metric"/>
                                <field name="packaging"/>
                            </tree>
                         </field>
                        </page>
                        <page name="vendors" string="Vendors List">
                        <field name="vendors_list" widget="One2many_list">
                            <tree editable="bottom">
                                <field name="application_id"/>
                                <field name="vendor"/>
                                <field name="vendor_category"/>
                                <field name="history_purchase"/>
                                <field name="offer"/>
                                <field name="comments"/>
                                <field name="apply_date"/>
                            </tree>
                        </field>
                        </page>
                    </notebook>
                    

                </sheet>
            </form>
        </field>
    </record>
    <record model="ir.actions.act_window" id="procurement_management_windows">
        <field name="name">Procurement</field>
        <field name="res_model">emdad.procurement</field>
        <field name="view_mode">kanban,form</field>
        <field name="domain">[]</field>
    </record>
    <record model="ir.actions.act_window" id="emdad_tender_windows">
        <field name="name">Tenders</field>
        <field name="res_model">emdad.tender</field>
        <field name="view_mode">kanban,form</field>
        <field name="domain">[]</field>
    </record>
<record model="ir.actions.client" id="dashboard">
    <field name="name">Dashboard</field>
    <field name="tag">emdad_procurement.dashboard</field>
</record>

    <menuitem id="emdad_procurement_menu" name="Procurement"/>
    
    <menuitem id="emdad_procurement_orders_menu"
              name="Procurement Orders"
              parent="emdad_procurement_menu"
              sequence="2"
              action="emdad_procurement.procurement_management_windows"/>
    <menuitem
        id="emdad_tender_main_menu"
        name="Tender"
        action="emdad_tender_windows"
        parent="emdad_procurement_menu"
        sequence="3"/>
        <menuitem
            id="emdad_procurement_dashboard_menu"
            name="Dashboard"
            action="dashboard"
            parent="emdad_procurement_menu"
            sequence="1"/>
</emdad>
